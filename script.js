// Language translations
const translations = {
  id: {
    // Navigation
    logo: "Empal Gentong Emak",
    "nav-home": "Beranda",
    "nav-menu": "Menu",
    "nav-about": "Tentang",

    // Hero Section
    "hero-title": "Empal Gentong Emak",
    "hero-subtitle": "Cita Rasa Autentik Cirebon yang Tak Terlupakan",
    "hero-description":
      "Nikmati kelezatan empal gentong tradisional dengan resep turun temurun yang telah dipercaya selama puluhan tahun",
    "hero-cta": "Lihat Menu",

    // Features
    "features-title": "Mengapa Memilih Kami?",
    "feature1-title": "Resep Tradisional",
    "feature1-desc":
      "Menggunakan resep turun temurun yang autentik dari Cirebon",
    "feature2-title": "Bahan Segar",
    "feature2-desc": "Menggunakan bahan-bahan segar pilihan setiap hari",
    "feature3-title": "Chef Berpengalaman",
    "feature3-desc": "Dimasak oleh chef berpengalaman lebih dari 20 tahun",

    // Popular Menu
    "popular-title": "Menu Populer",
    "menu1-name": "Empal Gentong",
    "menu1-desc": "Sup daging sapi dengan kuah santan yang kaya rempah",
    "menu2-name": "Nasi Jamblang",
    "menu2-desc": "Nasi dengan berbagai lauk khas Cirebon",
    "menu3-name": "Tahu Gejrot",
    "menu3-desc": "Tahu goreng dengan kuah asam manis pedas",

    // Menu Page
    "menu-header-title": "Menu Kami",
    "menu-header-desc": "Pilihan makanan khas Cirebon yang lezat dan autentik",
    "main-dishes-title": "Makanan Utama",
    "snacks-title": "Camilan",
    "beverages-title": "Minuman",

    // Menu Items
    "item1-name": "Empal Gentong",
    "item1-desc":
      "Sup daging sapi dengan kuah santan yang kaya rempah, disajikan dengan nasi putih",
    "item2-name": "Nasi Jamblang",
    "item2-desc":
      "Nasi dengan berbagai lauk khas Cirebon seperti empal, tahu, tempe, dan sayuran",
    "item3-name": "Sate Kalong",
    "item3-desc":
      "Sate daging sapi khas Cirebon dengan bumbu kacang yang gurih",
    "item4-name": "Tahu Gejrot",
    "item4-desc": "Tahu goreng dengan kuah asam manis pedas yang menyegarkan",
    "item5-name": "Kerupuk Melarat",
    "item5-desc": "Kerupuk khas Cirebon yang renyah dengan taburan bumbu",
    "item6-name": "Docang",
    "item6-desc": "Lontong dengan sayur dan kerupuk dalam kuah santan gurih",
    "item7-name": "Es Teh Manis",
    "item7-desc": "Teh manis dingin yang menyegarkan",
    "item8-name": "Es Jeruk",
    "item8-desc": "Jus jeruk segar dengan es batu",
    "item9-name": "Kopi Tubruk",
    "item9-desc": "Kopi tradisional Indonesia yang kental dan nikmat",

    // About Page
    "about-header-title": "Tentang Kami",
    "about-header-desc": "Cerita di balik kelezatan Empal Gentong Emak",
    "story-title": "Cerita Kami",
    "story-p1":
      "Empal Gentong Emak didirikan pada tahun 1995 oleh Ibu Siti Aminah, seorang ibu rumah tangga yang memiliki passion besar terhadap kuliner tradisional Cirebon. Berawal dari warung kecil di pinggir jalan, kini Empal Gentong Emak telah menjadi salah satu destinasi kuliner favorit di Cirebon.",
    "story-p2":
      "Resep empal gentong yang kami gunakan merupakan warisan turun temurun dari nenek moyang yang telah dipertahankan keasliannya selama puluhan tahun. Setiap mangkuk empal gentong yang kami sajikan dibuat dengan penuh cinta dan dedikasi untuk memberikan pengalaman kuliner yang tak terlupakan.",
    "story-p3":
      "Kami bangga menjadi bagian dari pelestarian kuliner tradisional Cirebon dan berkomitmen untuk terus menyajikan cita rasa autentik yang telah dipercaya oleh ribuan pelanggan setia.",

    // Values
    "values-title": "Nilai-Nilai Kami",
    "value1-title": "Tradisi",
    "value1-desc":
      "Mempertahankan resep dan cara memasak tradisional yang autentik",
    "value2-title": "Kualitas",
    "value2-desc":
      "Menggunakan bahan-bahan terbaik dan proses memasak yang teliti",
    "value3-title": "Pelayanan",
    "value3-desc": "Memberikan pelayanan terbaik dengan keramahan khas Cirebon",
    "value4-title": "Keberlanjutan",
    "value4-desc": "Mendukung petani lokal dan menjaga kelestarian lingkungan",

    // Team
    "team-title": "Tim Kami",
    "team1-name": "Ibu Siti Aminah",
    "team1-role": "Pendiri & Head Chef",
    "team1-desc": "Penjaga resep tradisional dan jiwa dari Empal Gentong Emak",
    "team2-name": "Bapak Ahmad",
    "team2-role": "Manager Operasional",
    "team2-desc": "Memastikan kualitas dan pelayanan terbaik setiap hari",
    "team3-name": "Mbak Rina",
    "team3-role": "Sous Chef",
    "team3-desc": "Ahli dalam mempersiapkan bumbu dan rempah-rempah",

    // Contact
    "contact-title": "Hubungi Kami",
    "contact-address-title": "Alamat",
    "contact-phone-title": "Telepon",
    "contact-email-title": "Email",
    "contact-hours-title": "Jam Buka",
    "contact-hours-text": "Senin - Minggu: 08:00 - 22:00",

    // Footer
    "footer-desc": "Menyajikan cita rasa autentik Cirebon sejak 1995",
    "footer-contact": "Kontak",
    "footer-hours": "Jam Buka",
    "footer-hours-text": "Senin - Minggu: 08:00 - 22:00",

    // Loading
    "loading-text": "Memuat...",
  },
  en: {
    // Navigation
    logo: "Empal Gentong Emak",
    "nav-home": "Home",
    "nav-menu": "Menu",
    "nav-about": "About",

    // Hero Section
    "hero-title": "Empal Gentong Emak",
    "hero-subtitle": "Unforgettable Authentic Cirebon Flavors",
    "hero-description":
      "Enjoy the deliciousness of traditional empal gentong with ancestral recipes that have been trusted for decades",
    "hero-cta": "View Menu",

    // Features
    "features-title": "Why Choose Us?",
    "feature1-title": "Traditional Recipe",
    "feature1-desc": "Using authentic ancestral recipes from Cirebon",
    "feature2-title": "Fresh Ingredients",
    "feature2-desc": "Using the finest fresh ingredients every day",
    "feature3-title": "Experienced Chef",
    "feature3-desc": "Cooked by chefs with more than 20 years of experience",

    // Popular Menu
    "popular-title": "Popular Menu",
    "menu1-name": "Empal Gentong",
    "menu1-desc": "Beef soup with rich spiced coconut milk broth",
    "menu2-name": "Nasi Jamblang",
    "menu2-desc": "Rice with various traditional Cirebon side dishes",
    "menu3-name": "Tahu Gejrot",
    "menu3-desc": "Fried tofu with sweet and sour spicy sauce",

    // Menu Page
    "menu-header-title": "Our Menu",
    "menu-header-desc": "Delicious and authentic Cirebon food choices",
    "main-dishes-title": "Main Dishes",
    "snacks-title": "Snacks",
    "beverages-title": "Beverages",

    // Menu Items
    "item1-name": "Empal Gentong",
    "item1-desc":
      "Beef soup with rich spiced coconut milk broth, served with white rice",
    "item2-name": "Nasi Jamblang",
    "item2-desc":
      "Rice with various Cirebon specialties like empal, tofu, tempeh, and vegetables",
    "item3-name": "Sate Kalong",
    "item3-desc": "Cirebon-style beef satay with savory peanut sauce",
    "item4-name": "Tahu Gejrot",
    "item4-desc": "Fried tofu with refreshing sweet and sour spicy sauce",
    "item5-name": "Kerupuk Melarat",
    "item5-desc": "Crispy Cirebon crackers with spice sprinkles",
    "item6-name": "Docang",
    "item6-desc":
      "Rice cake with vegetables and crackers in savory coconut milk broth",
    "item7-name": "Sweet Iced Tea",
    "item7-desc": "Refreshing cold sweet tea",
    "item8-name": "Orange Juice",
    "item8-desc": "Fresh orange juice with ice cubes",
    "item9-name": "Tubruk Coffee",
    "item9-desc": "Traditional Indonesian coffee that is thick and delicious",

    // About Page
    "about-header-title": "About Us",
    "about-header-desc":
      "The story behind the deliciousness of Empal Gentong Emak",
    "story-title": "Our Story",
    "story-p1":
      "Empal Gentong Emak was founded in 1995 by Mrs. Siti Aminah, a housewife who has a great passion for traditional Cirebon cuisine. Starting from a small roadside stall, Empal Gentong Emak has now become one of the favorite culinary destinations in Cirebon.",
    "story-p2":
      "The empal gentong recipe we use is an ancestral heritage that has been maintained for decades. Every bowl of empal gentong we serve is made with love and dedication to provide an unforgettable culinary experience.",
    "story-p3":
      "We are proud to be part of preserving traditional Cirebon cuisine and are committed to continuing to serve authentic flavors that have been trusted by thousands of loyal customers.",

    // Values
    "values-title": "Our Values",
    "value1-title": "Tradition",
    "value1-desc":
      "Maintaining authentic traditional recipes and cooking methods",
    "value2-title": "Quality",
    "value2-desc": "Using the best ingredients and careful cooking processes",
    "value3-title": "Service",
    "value3-desc":
      "Providing the best service with typical Cirebon friendliness",
    "value4-title": "Sustainability",
    "value4-desc":
      "Supporting local farmers and maintaining environmental sustainability",

    // Team
    "team-title": "Our Team",
    "team1-name": "Mrs. Siti Aminah",
    "team1-role": "Founder & Head Chef",
    "team1-desc":
      "Guardian of traditional recipes and soul of Empal Gentong Emak",
    "team2-name": "Mr. Ahmad",
    "team2-role": "Operations Manager",
    "team2-desc": "Ensuring the best quality and service every day",
    "team3-name": "Ms. Rina",
    "team3-role": "Sous Chef",
    "team3-desc": "Expert in preparing spices and seasonings",

    // Contact
    "contact-title": "Contact Us",
    "contact-address-title": "Address",
    "contact-phone-title": "Phone",
    "contact-email-title": "Email",
    "contact-hours-title": "Opening Hours",
    "contact-hours-text": "Monday - Sunday: 08:00 - 22:00",

    // Footer
    "footer-desc": "Serving authentic Cirebon flavors since 1995",
    "footer-contact": "Contact",
    "footer-hours": "Opening Hours",
    "footer-hours-text": "Monday - Sunday: 08:00 - 22:00",

    // Loading
    "loading-text": "Loading...",
  },
};

// Current language
let currentLang = "id";

// DOM elements
const themeToggle = document.getElementById("themeToggle");
const langToggle = document.getElementById("langToggle");
const musicToggle = document.getElementById("musicToggle");
const backToTop = document.getElementById("backToTop");
const backgroundMusic = document.getElementById("backgroundMusic");
const hamburger = document.querySelector(".hamburger");
const navMenu = document.querySelector(".nav-menu");

function createLoadingScreen() {
  // Create loading overlay
  const loadingOverlay = document.createElement("div");
  loadingOverlay.id = "loadingScreen";
  loadingOverlay.innerHTML = `
    <div class="loading-container">
      <div class="loading-logo">
        <img src="items/images/logo.png" alt="Empal Gentong Emak" id="loadingLogo">
        <div class="loading-pulse"></div>
      </div>
      <div class="loading-text" data-id="loading-text">Memuat...</div>
      <div class="loading-progress">
        <div class="loading-bar"></div>
      </div>
      <div class="loading-percentage">0%</div>
    </div>
  `;

  const loadingStyles = `
    <style id="loadingStyles">
      #loadingScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.8s ease, visibility 0.8s ease;
        background: var(--loading-bg);
      }

      [data-theme="light"] #loadingScreen {
        --loading-bg: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        --loading-text-color: #333;
        --loading-accent: #8b4513;
        --loading-secondary: #f5f5f5;
      }

      [data-theme="dark"] #loadingScreen {
        --loading-bg: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        --loading-text-color: #ffffff;
        --loading-accent: #8b4513;
        --loading-secondary: #333333;
      }

      .loading-container {
        text-align: center;
        max-width: 300px;
        width: 90%;
      }

      .loading-logo {
        position: relative;
        margin-bottom: 30px;
        display: inline-block;
      }

      #loadingLogo {
        width: 120px;
        height: 120px;
        object-fit: contain;
        border-radius: 50%;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        animation: logoFloat 3s ease-in-out infinite alternate;
        position: relative;
        z-index: 2;
      }

      .loading-pulse {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 140px;
        height: 140px;
        border: 2px solid var(--loading-accent);
        border-radius: 50%;
        animation: pulse 2s ease-in-out infinite;
        opacity: 0.6;
      }

      .loading-text {
        font-size: 1.2rem;
        color: var(--loading-text-color);
        margin-bottom: 25px;
        font-weight: 600;
        animation: textFade 2s ease-in-out infinite alternate;
      }

      .loading-progress {
        width: 100%;
        height: 4px;
        background: var(--loading-secondary);
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 15px;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      }

      .loading-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, var(--loading-accent), #d2691e);
        border-radius: 2px;
        transition: width 0.3s ease;
        position: relative;
      }

      .loading-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        animation: shimmer 1.5s infinite;
      }

      .loading-percentage {
        font-size: 0.9rem;
        color: var(--loading-text-color);
        opacity: 0.8;
        font-weight: 500;
      }

      #loadingScreen.fade-out {
        opacity: 0;
        visibility: hidden;
      }

      @keyframes logoFloat {
        0% { transform: translateY(0px) rotate(0deg); }
        100% { transform: translateY(-10px) rotate(5deg); }
      }

      @keyframes pulse {
        0% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
        50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.3; }
        100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
      }

      @keyframes textFade {
        0% { opacity: 0.7; }
        100% { opacity: 1; }
      }

      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(200%); }
      }

      @media (max-width: 768px) {
        #loadingLogo {
          width: 100px;
          height: 100px;
        }
        
        .loading-pulse {
          width: 120px;
          height: 120px;
        }
        
        .loading-text {
          font-size: 1.1rem;
        }
      }
    </style>
  `;

  document.head.insertAdjacentHTML("beforeend", loadingStyles);

  document.body.appendChild(loadingOverlay);

  return loadingOverlay;
}

function simulateLoading() {
  const loadingBar = document.querySelector(".loading-bar");
  const loadingPercentage = document.querySelector(".loading-percentage");
  let progress = 0;

  const interval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress > 100) progress = 100;

    loadingBar.style.width = progress + "%";
    loadingPercentage.textContent = Math.round(progress) + "%";

    if (progress >= 100) {
      clearInterval(interval);
      setTimeout(hideLoadingScreen, 500);
    }
  }, 200);
}

function hideLoadingScreen() {
  const loadingScreen = document.getElementById("loadingScreen");
  const loadingStyles = document.getElementById("loadingStyles");

  if (loadingScreen) {
    loadingScreen.classList.add("fade-out");
    setTimeout(() => {
      loadingScreen.remove();
      if (loadingStyles) loadingStyles.remove();
    }, 800);
  }
}

function updateLoadingTheme() {
  const loadingScreen = document.getElementById("loadingScreen");
  if (loadingScreen) {
    const currentTheme =
      document.documentElement.getAttribute("data-theme") || "light";
  }
}

function initializeLoading() {
  const loadingOverlay = createLoadingScreen();

  updateLoadingTheme();

  setTimeout(() => {
    simulateLoading();
  }, 500);
}

// Initialize
document.addEventListener("DOMContentLoaded", () => {
  initializeLoading();

  // Load saved theme and language
  const savedTheme = localStorage.getItem("theme") || "light";
  const savedLang = localStorage.getItem("language") || "id";

  setTheme(savedTheme);
  setLanguage(savedLang);

  // Update loading screen theme
  updateLoadingTheme();

  // Initialize music state
  initializeMusicState();

  // Add loading animation for page elements
  const elements = document.querySelectorAll(
    ".feature-card, .menu-card, .value-card, .team-member"
  );
  elements.forEach((el, index) => {
    el.classList.add("loading");
    setTimeout(() => {
      el.classList.add("loaded");
    }, index * 100);
  });

  // Initialize music
  if (backgroundMusic) {
    backgroundMusic.volume = 0.3;
  }
});

// Theme toggle
themeToggle.addEventListener("click", () => {
  const currentTheme = document.documentElement.getAttribute("data-theme");
  const newTheme = currentTheme === "dark" ? "light" : "dark";
  setTheme(newTheme);
});

function setTheme(theme) {
  document.documentElement.setAttribute("data-theme", theme);
  themeToggle.textContent = theme === "dark" ? "â˜€ï¸" : "ðŸŒ™";
  localStorage.setItem("theme", theme);

  // Update loading screen theme if it exists
  updateLoadingTheme();
}

// Language toggle
langToggle.addEventListener("click", () => {
  const newLang = currentLang === "id" ? "en" : "id";
  setLanguage(newLang);
});

function setLanguage(lang) {
  currentLang = lang;
  langToggle.textContent = lang === "id" ? "EN" : "ID";
  document.documentElement.setAttribute("lang", lang);

  // Update all text elements
  const elements = document.querySelectorAll("[data-id]");
  elements.forEach((element) => {
    const key = element.getAttribute("data-id");
    if (translations[lang] && translations[lang][key]) {
      if (element.tagName === "INPUT" || element.tagName === "TEXTAREA") {
        element.placeholder = translations[lang][key];
      } else {
        element.textContent = translations[lang][key];
      }
    }
  });

  localStorage.setItem("language", lang);
}

// Music state management
let isPlaying = false;
let currentTime = 0;
let musicVolume = 0.3;

// Initialize music state from localStorage
function initializeMusicState() {
  const savedMusicState = localStorage.getItem("musicState");
  const savedMusicTime = localStorage.getItem("musicTime");
  const savedMusicVolume = localStorage.getItem("musicVolume");

  if (savedMusicState === "playing") {
    isPlaying = true;
    musicToggle.classList.add("playing");
    musicToggle.textContent = "ðŸŽ¶";
  }

  if (savedMusicTime) {
    currentTime = Number.parseFloat(savedMusicTime);
  }

  if (savedMusicVolume) {
    musicVolume = Number.parseFloat(savedMusicVolume);
  }

  if (backgroundMusic) {
    backgroundMusic.volume = musicVolume;
    backgroundMusic.currentTime = currentTime;

    if (isPlaying) {
      // Small delay to ensure page is loaded
      setTimeout(() => {
        backgroundMusic.play().catch((e) => {
          console.log("Auto-play failed:", e);
          // Reset state if autoplay fails
          isPlaying = false;
          musicToggle.classList.remove("playing");
          musicToggle.textContent = "ðŸŽµ";
          localStorage.setItem("musicState", "paused");
        });
      }, 100);
    }
  }
}

// Save music state periodically
function saveMusicState() {
  if (backgroundMusic && !backgroundMusic.paused) {
    localStorage.setItem("musicTime", backgroundMusic.currentTime.toString());
    localStorage.setItem("musicVolume", backgroundMusic.volume.toString());
  }
}

// Music toggle with state persistence
musicToggle.addEventListener("click", () => {
  if (backgroundMusic) {
    if (isPlaying) {
      backgroundMusic.pause();
      musicToggle.classList.remove("playing");
      musicToggle.textContent = "ðŸŽµ";
      localStorage.setItem("musicState", "paused");
      localStorage.setItem("musicTime", backgroundMusic.currentTime.toString());
    } else {
      backgroundMusic.play().catch((e) => {
        console.log("Audio play failed:", e);
      });
      musicToggle.classList.add("playing");
      musicToggle.textContent = "ðŸŽ¶";
      localStorage.setItem("musicState", "playing");
    }
    isPlaying = !isPlaying;
  }
});

// Save music time periodically while playing
setInterval(() => {
  if (backgroundMusic && !backgroundMusic.paused) {
    saveMusicState();
  }
}, 1000);

// Save state before page unload
window.addEventListener("beforeunload", () => {
  saveMusicState();
});

// Handle music end (loop)
if (backgroundMusic) {
  backgroundMusic.addEventListener("ended", () => {
    backgroundMusic.currentTime = 0;
    if (isPlaying) {
      backgroundMusic.play();
    }
  });

  // Update time tracking
  backgroundMusic.addEventListener("timeupdate", () => {
    currentTime = backgroundMusic.currentTime;
  });
}

// Back to top functionality
window.addEventListener("scroll", () => {
  if (window.pageYOffset > 300) {
    backToTop.classList.add("visible");
  } else {
    backToTop.classList.remove("visible");
  }
});

backToTop.addEventListener("click", () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth",
  });
});

// Mobile menu toggle
hamburger.addEventListener("click", (e) => {
  e.stopPropagation();
  hamburger.classList.toggle("active");
  navMenu.classList.toggle("active");

  // Prevent body scroll when menu is open
  if (navMenu.classList.contains("active")) {
    document.body.style.overflow = "hidden";
  } else {
    document.body.style.overflow = "auto";
  }
});

// Close mobile menu when clicking outside
document.addEventListener("click", (e) => {
  if (!navMenu.contains(e.target) && !hamburger.contains(e.target)) {
    hamburger.classList.remove("active");
    navMenu.classList.remove("active");
    document.body.style.overflow = "auto";
  }
});

// Close mobile menu when clicking on a link
document.querySelectorAll(".nav-menu a").forEach((link) => {
  link.addEventListener("click", () => {
    hamburger.classList.remove("active");
    navMenu.classList.remove("active");
    document.body.style.overflow = "auto";
  });
});

// Close mobile menu on window resize
window.addEventListener("resize", () => {
  if (window.innerWidth > 768) {
    hamburger.classList.remove("active");
    navMenu.classList.remove("active");
    document.body.style.overflow = "auto";
  }
});

// Smooth scroll for anchor links
document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
  anchor.addEventListener("click", function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute("href"));
    if (target) {
      target.scrollIntoView({
        behavior: "smooth",
        block: "start",
      });
    }
  });
});

// Add scroll animations
const observerOptions = {
  threshold: 0.1,
  rootMargin: "0px 0px -50px 0px",
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      entry.target.classList.add("loaded");
    }
  });
}, observerOptions);

// Observe elements for animation
document
  .querySelectorAll(
    ".feature-card, .menu-card, .value-card, .team-member, .menu-item"
  )
  .forEach((el) => {
    observer.observe(el);
  });

// Add hover effects for menu items
document.querySelectorAll(".menu-card, .menu-item").forEach((item) => {
  item.addEventListener("mouseenter", function () {
    this.style.transform = "translateY(-5px) scale(1.02)";
  });

  item.addEventListener("mouseleave", function () {
    this.style.transform = "translateY(0) scale(1)";
  });
});

// Add click effects for buttons
document.querySelectorAll("button, .cta-button").forEach((button) => {
  button.addEventListener("click", function (e) {
    const ripple = document.createElement("span");
    const rect = this.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = e.clientX - rect.left - size / 2;
    const y = e.clientY - rect.top - size / 2;

    ripple.style.width = ripple.style.height = size + "px";
    ripple.style.left = x + "px";
    ripple.style.top = y + "px";
    ripple.classList.add("ripple");

    this.appendChild(ripple);

    setTimeout(() => {
      ripple.remove();
    }, 600);
  });
});

// Add ripple effect CSS
const style = document.createElement("style");
style.textContent = `
    .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.6);
        transform: scale(0);
        animation: ripple-animation 0.6s linear;
        pointer-events: none;
    }
    
    @keyframes ripple-animation {
        to {
            transform: scale(4);
            opacity: 0;
        }
    }
    
    button, .cta-button {
        position: relative;
        overflow: hidden;
    }
`;
document.head.appendChild(style);

// Preload images
function preloadImages() {
  const images = document.querySelectorAll('img[src*="placeholder"]');
  images.forEach((img) => {
    const newImg = new Image();
    newImg.src = img.src;
  });
}

// Call preload on page load
window.addEventListener("load", preloadImages);

// Add keyboard navigation
document.addEventListener("keydown", (e) => {
  // ESC key closes mobile menu
  if (e.key === "Escape") {
    hamburger.classList.remove("active");
    navMenu.classList.remove("active");
  }

  // Space bar toggles music
  if (e.code === "Space" && e.target === document.body) {
    e.preventDefault();
    musicToggle.click();
  }

  // Home key goes to top
  if (e.key === "Home") {
    e.preventDefault();
    backToTop.click();
  }
});

// Add performance optimization
let ticking = false;

function updateScrollElements() {
  // Update back to top button
  if (window.pageYOffset > 300) {
    backToTop.classList.add("visible");
  } else {
    backToTop.classList.remove("visible");
  }

  ticking = false;
}

window.addEventListener("scroll", () => {
  if (!ticking) {
    requestAnimationFrame(updateScrollElements);
    ticking = true;
  }
});

// Additional loading screen enhancements
function addLoadingScreenEvents() {
  // Handle logo image load error
  const loadingLogo = document.getElementById("loadingLogo");
  if (loadingLogo) {
    loadingLogo.addEventListener("error", function () {
      // Replace with text if image fails to load
      this.style.display = "none";
      const textLogo = document.createElement("div");
      textLogo.innerHTML = "ðŸ²";
      textLogo.style.fontSize = "4rem";
      textLogo.style.animation = "logoFloat 3s ease-in-out infinite alternate";
      this.parentNode.insertBefore(textLogo, this);
    });
  }
}

// Enhanced loading with resource monitoring
function enhancedLoading() {
  let resourcesLoaded = 0;
  let totalResources = 0;

  // Count resources to load
  const images = document.querySelectorAll("img");
  const scripts = document.querySelectorAll("script[src]");
  const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');

  totalResources = images.length + scripts.length + stylesheets.length;

  if (totalResources === 0) {
    // If no resources to load, simulate loading
    simulateLoading();
    return;
  }

  const updateProgress = () => {
    resourcesLoaded++;
    const progress = (resourcesLoaded / totalResources) * 100;
    const loadingBar = document.querySelector(".loading-bar");
    const loadingPercentage = document.querySelector(".loading-percentage");

    if (loadingBar && loadingPercentage) {
      loadingBar.style.width = progress + "%";
      loadingPercentage.textContent = Math.round(progress) + "%";
    }

    if (resourcesLoaded >= totalResources) {
      setTimeout(hideLoadingScreen, 500);
    }
  };

  // Monitor image loading
  images.forEach((img) => {
    if (img.complete) {
      updateProgress();
    } else {
      img.addEventListener("load", updateProgress);
      img.addEventListener("error", updateProgress);
    }
  });

  // Monitor script loading
  scripts.forEach((script) => {
    script.addEventListener("load", updateProgress);
    script.addEventListener("error", updateProgress);
  });

  // Monitor stylesheet loading
  stylesheets.forEach((link) => {
    link.addEventListener("load", updateProgress);
    link.addEventListener("error", updateProgress);
  });

  // Fallback timeout
  setTimeout(() => {
    if (document.getElementById("loadingScreen")) {
      hideLoadingScreen();
    }
  }, 10000); // 10 second maximum loading time
}

// Initialize enhanced loading when DOM is ready
document.addEventListener("DOMContentLoaded", () => {
  addLoadingScreenEvents();

  setTimeout(() => {
    enhancedLoading();
  }, 500);
});
